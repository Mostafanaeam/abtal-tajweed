<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„ØªØ¬ÙˆÙŠØ¯ - Ø§Ù„Ù…Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø³ÙƒÙˆÙ†</title>
    <style>
      :root {
        --primary: #ff6b6b;
        --secondary: #4ecdc4;
        --accent: #ffe66d;
        --dark: #2c3e50;
        --light: #f7f9fc;
        --success: #2ecc71;
        --error: #e74c3c;
        --font-main: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: var(--font-main);
      }

      body {
        background-color: #e0f7fa;
        background-image: radial-gradient(#4ecdc4 1px, transparent 1px);
        background-size: 20px 20px;
        color: var(--dark);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        width: 100%;
        max-width: 800px;
        background: white;
        border-radius: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
        border: 5px solid var(--secondary);
      }

      /* Header & Dashboard */
      header {
        background: var(--secondary);
        color: white;
        padding: 20px;
        text-align: center;
        border-bottom: 5px solid rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .mute-btn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid white;
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.2s;
      }
      .mute-btn:hover {
        background: white;
        color: var(--secondary);
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 5px;
        text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
      }
      h2 {
        font-size: 1.5rem;
        color: var(--dark);
        margin-bottom: 15px;
      }
      h3 {
        color: var(--primary);
        margin: 10px 0;
      }

      .dashboard-stats {
        display: flex;
        justify-content: space-around;
        background: var(--accent);
        padding: 10px;
        font-weight: bold;
        color: var(--dark);
      }

      .stat-box {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Navigation Buttons */
      .nav-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        padding: 40px;
      }

      .big-btn {
        padding: 30px;
        border: none;
        border-radius: 20px;
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 15px;
        color: white;
        font-weight: bold;
        box-shadow: 0 5px 0 rgba(0, 0, 0, 0.2);
      }

      .big-btn:active {
        transform: translateY(5px);
        box-shadow: none;
      }

      .btn-learn {
        background: var(--primary);
      }
      .btn-play {
        background: #9b59b6;
      }

      /* Learning Section */
      .section {
        display: none;
        padding: 20px;
        animation: fadeIn 0.5s;
      }

      .section.active {
        display: block;
      }

      /* Mind Map */
      .mind-map {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }

      .mm-node {
        background: white;
        border: 3px solid var(--secondary);
        padding: 10px 20px;
        border-radius: 50px;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .mm-root {
        background: var(--accent);
        font-size: 1.2rem;
        border-color: #f1c40f;
      }

      .mm-branches {
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .mm-leaf {
        background: #e8f8f5;
        font-size: 0.9rem;
      }
      .mm-sub {
        font-size: 0.8rem;
        background: #fdf2e9;
        margin-top: 5px;
      }

      /* Explanation Cards */
      .lesson-card {
        background: #fff;
        border: 2px solid #eee;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .quran-example {
        font-family: "Traditional Arabic", serif;
        font-size: 1.8rem;
        color: var(--dark);
        background: #fcf8e3;
        padding: 10px;
        border-radius: 10px;
        text-align: center;
        margin: 10px 0;
        border: 1px dashed #d4b168;
      }

      .highlight {
        color: var(--error);
        font-weight: bold;
      }

      /* Game Section */
      .question-box {
        text-align: center;
        padding: 20px;
      }

      .question-text {
        font-size: 1.3rem;
        margin-bottom: 30px;
        background: white;
        padding: 20px;
        border-radius: 15px;
        border: 2px solid var(--secondary);
      }

      .answers-grid {
        display: grid;
        gap: 15px;
      }

      .ans-btn {
        padding: 15px;
        border: 2px solid #ddd;
        background: white;
        border-radius: 10px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .ans-btn:hover {
        background: var(--light);
        border-color: var(--secondary);
      }

      .tf-grid {
        grid-template-columns: 1fr 1fr;
      }
      .btn-true {
        color: var(--success);
        border-color: var(--success);
      }
      .btn-false {
        color: var(--error);
        border-color: var(--error);
      }

      .btn-true:hover {
        background: #e8f8f5;
      }
      .btn-false:hover {
        background: #fdedec;
      }

      /* Feedback Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
      }

      .modal {
        background: white;
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        animation: popIn 0.3s;
        max-width: 90%;
      }

      .feedback-icon {
        font-size: 4rem;
        display: block;
        margin-bottom: 10px;
      }

      .home-btn {
        background: var(--dark);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        margin-top: 20px;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes popIn {
        from {
          transform: scale(0.5);
        }
        to {
          transform: scale(1);
        }
      }

      /* Utils */
      .hidden {
        display: none !important;
      }
      .nav-top {
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <button
          id="mute-btn"
          class="mute-btn"
          onclick="SoundManager.toggleMute()"
        >
          ğŸ”Š
        </button>
        <h1>ğŸŒŸ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„ØªØ¬ÙˆÙŠØ¯ ğŸŒŸ</h1>
        <p>Ø±Ø­Ù„Ø© Ù…Ù…ØªØ¹Ø© Ù„ØªØ¹Ù„Ù… Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø³ÙƒÙˆÙ†</p>
      </header>

      <!-- Dashboard Info -->
      <div class="dashboard-stats">
        <div class="stat-box">â­ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
        <div class="stat-box">ğŸ† Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="level">Ù…Ø¨ØªØ¯Ø¦</span></div>
      </div>

      <!-- Home Screen -->
      <div id="home" class="section active">
        <div class="nav-grid">
          <button class="big-btn btn-learn" onclick="showSection('learn')">
            ğŸ“š Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù…
            <span style="font-size: 1rem; font-weight: normal"
              >Ø´Ø±Ø­ ÙˆØ®Ø±Ø§Ø¦Ø· Ø°Ù‡Ù†ÙŠØ©</span
            >
          </button>
          <button class="big-btn btn-play" onclick="startQuiz()">
            ğŸ® Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø®ØªØ¨Ø± Ù†ÙØ³Ùƒ
            <span style="font-size: 1rem; font-weight: normal"
              >Ø£Ø³Ø¦Ù„Ø© ÙˆØªØ­Ø¯ÙŠØ§Øª</span
            >
          </button>
        </div>
      </div>

      <!-- Learn Screen -->
      <div id="learn" class="section">
        <div class="nav-top">
          <h2>ğŸ§  Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ©</h2>
          <button class="home-btn" onclick="showSection('home')">
            ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </button>
        </div>

        <div class="mind-map">
          <div class="mm-node mm-root">Ø§Ù„Ù…Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø³ÙƒÙˆÙ†</div>
          <div style="font-size: 2rem; color: #ccc">â¬‡</div>
          <div class="mm-branches">
            <div
              style="display: flex; flex-direction: column; align-items: center"
            >
              <button class="mm-node mm-leaf" onclick="scrollToId('arid')">
                Ø§Ù„Ù…Ø¯ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù„Ù„Ø³ÙƒÙˆÙ†
              </button>
            </div>
            <div
              style="display: flex; flex-direction: column; align-items: center"
            >
              <button class="mm-node mm-leaf" onclick="scrollToId('leen')">
                Ù…Ø¯ Ø§Ù„Ù„ÙŠÙ†
              </button>
            </div>
            <div
              style="display: flex; flex-direction: column; align-items: center"
            >
              <div class="mm-node mm-leaf" style="background: #fce4ec">
                Ø§Ù„Ù…Ø¯ Ø§Ù„Ù„Ø§Ø²Ù…
              </div>
              <div class="mm-branches" style="margin-top: 5px">
                <span class="mm-node mm-sub">ÙƒÙ„Ù…ÙŠ</span>
                <span class="mm-node mm-sub">Ø­Ø±ÙÙŠ</span>
              </div>
            </div>
          </div>
        </div>

        <hr
          style="margin: 20px 0; border: none; height: 2px; background: #eee"
        />

        <!-- Content Details -->
        <div id="arid" class="lesson-card">
          <h3>ğŸ”¹ 1. Ø§Ù„Ù…Ø¯ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù„Ù„Ø³ÙƒÙˆÙ†</h3>
          <p>
            <strong>Ø§Ù„ØªØ¹Ø±ÙŠÙ:</strong> Ù‡Ùˆ Ø£Ù† ÙŠØ£ØªÙŠ Ø¨Ø¹Ø¯ Ø­Ø±Ù Ø§Ù„Ù…Ø¯ Ø­Ø±Ù Ø³Ø§ÙƒÙ† Ø¨Ø³Ø¨Ø¨
            Ø§Ù„ÙˆÙ‚Ù Ø¹Ù„ÙŠÙ‡.
          </p>
          <br />
          <div style="background: #e3f2fd; padding: 10px; border-radius: 8px">
            <p>ğŸ›‘ <strong>Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚Ù:</strong> ÙŠÙ…Ø¯ 2 Ø£Ùˆ 4 Ø£Ùˆ 6 Ø­Ø±ÙƒØ§Øª.</p>
            <p>ğŸŸ¢ <strong>Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙ„:</strong> ÙŠÙ…Ø¯ Ø­Ø±ÙƒØªÙŠÙ† ÙÙ‚Ø· (Ù…Ø¯ Ø·Ø¨ÙŠØ¹ÙŠ).</p>
          </div>
          <br />
          <h4>Ø£Ù…Ø«Ù„Ø© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª (Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©):</h4>
          <div class="quran-example">
            ÙŠÙØ¹Ù’Ù„ÙÙ…ÙÙˆÙ†<span class="highlight">Ù</span> â¬… ÙŠÙØ¹Ù’Ù„ÙÙ…ÙÙˆÙ†<span
              class="highlight"
              >Ù’</span
            >
          </div>
          <div class="quran-example">
            Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠ<span class="highlight">Ù…Ù</span> â¬… Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠ<span
              class="highlight"
              >Ù…Ù’</span
            >
          </div>
          <div class="quran-example">
            Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠ<span class="highlight">Ù†Ù</span> â¬… Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠ<span
              class="highlight"
              >Ù†Ù’</span
            >
          </div>
        </div>

        <div id="leen" class="lesson-card">
          <h3>ğŸ”¹ 2. Ù…Ø¯ Ø§Ù„Ù„ÙŠÙ†</h3>
          <p>
            <strong>Ø§Ù„ØªØ¹Ø±ÙŠÙ:</strong> Ù‡Ùˆ Ø§Ù„ÙˆØ§Ùˆ Ø£Ùˆ Ø§Ù„ÙŠØ§Ø¡ Ø§Ù„Ø³Ø§ÙƒÙ†Ø© Ø§Ù„Ù…ÙØªÙˆØ­ Ù…Ø§
            Ù‚Ø¨Ù„Ù‡Ø§ØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ø³ÙƒÙˆÙ† Ø¹Ø§Ø±Ø¶ Ù„Ù„ÙˆÙ‚Ù.
          </p>
          <br />
          <div style="background: #e8f5e9; padding: 10px; border-radius: 8px">
            <p>ğŸ›‘ <strong>Ø´Ø±Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</strong> Ø§Ù„ÙˆÙ‚Ù ÙÙ‚Ø·.</p>
            <p>ğŸ“ <strong>Ø§Ù„Ù…Ù‚Ø¯Ø§Ø±:</strong> 2 Ø£Ùˆ 4 Ø£Ùˆ 6 Ø­Ø±ÙƒØ§Øª.</p>
          </div>
          <br />
          <h4>Ø£Ù…Ø«Ù„Ø© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª (Ø³ÙˆØ±Ø© Ù‚Ø±ÙŠØ´):</h4>
          <div class="quran-example">
            Ù‚ÙØ±Ù<span class="highlight">ÙŠÙ’</span>Ø´Ù â¬… Ù‚ÙØ±ÙÙŠÙ’Ø´Ù’
          </div>
          <div class="quran-example">
            Ø§Ù„ØµÙ‘Ù<span class="highlight">ÙŠÙ’</span>ÙÙ â¬… Ø§Ù„ØµÙ‘ÙÙŠÙ’ÙÙ’
          </div>
          <div class="quran-example">
            Ø®Ù<span class="highlight">ÙˆÙ’</span>ÙÙ â¬… Ø®ÙÙˆÙ’ÙÙ’
          </div>
        </div>
      </div>

      <!-- Game Screen -->
      <div id="game" class="section">
        <div class="nav-top">
          <h2 id="phase-title">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØµØ­ Ø£Ù… Ø®Ø·Ø£</h2>
          <button class="home-btn" onclick="showSection('home')">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="question-box">
          <div id="question-text" class="question-text">Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>

          <!-- TF Buttons -->
          <div id="tf-buttons" class="answers-grid tf-grid hidden">
            <button class="ans-btn btn-true" onclick="checkAnswer(true)">
              âœ”ï¸ ØµØ­
            </button>
            <button class="ans-btn btn-false" onclick="checkAnswer(false)">
              âŒ Ø®Ø·Ø£
            </button>
          </div>

          <!-- MCQ Buttons -->
          <div id="mcq-buttons" class="answers-grid hidden">
            <!-- Will be populated by JS -->
          </div>
        </div>
        <div style="text-align: center; margin-top: 20px; color: #7f8c8d">
          Ø§Ù„Ø³Ø¤Ø§Ù„ <span id="q-num">1</span> Ù…Ù† 10
        </div>
      </div>
    </div>

    <!-- Result Modal -->
    <div id="feedback-modal" class="modal-overlay">
      <div class="modal">
        <span id="feedback-icon" class="feedback-icon">ğŸ‰</span>
        <h2 id="feedback-title">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</h2>
        <p id="feedback-msg">Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„!</p>
        <button
          class="home-btn"
          style="background: var(--secondary)"
          onclick="nextQuestion()"
        >
          Ø§Ù„ØªØ§Ù„ÙŠ â¡
        </button>
      </div>
    </div>

    <script>
      // --- Data ---
      const tfQuestions = [
        {
          q: "ÙŠÙØ¹Ø±Ù Ø§Ù„Ù…Ø¯ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù„Ù„Ø³ÙƒÙˆÙ† Ø¨Ø£Ù†Ù‡ Ø­Ø±Ù Ù…Ø¯ ÙŠØ£ØªÙŠ Ø¨Ø¹Ø¯Ù‡ Ø­Ø±Ù Ø³ÙƒÙ† Ø¨Ø³Ø¨Ø¨ Ø§Ù„ÙˆÙ‚Ù.",
          a: true,
        },
        { q: "ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØµÙ„ØŒ ÙŠÙÙ…Ø¯ Ø§Ù„Ù…Ø¯ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù„Ù„Ø³ÙƒÙˆÙ† Ø­Ø±ÙƒØªÙŠÙ† ÙÙ‚Ø·.", a: true },
        { q: "ÙŠÙØ·Ø¨Ù‚ Ù…Ø¯ Ø§Ù„Ù„ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆØµÙ„ ÙˆØ§Ù„ÙˆÙ‚Ù.", a: false }, // False, only waqf
        { q: "Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¯ Ø§Ù„Ù„ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚Ù (2 Ø£Ùˆ 4 Ø£Ùˆ 6).", a: true },
        { q: "ÙƒÙ„Ù…Ø© (Ù‚ÙØ±ÙÙŠÙ’Ø´Ù) Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ù…Ø¯ Ø§Ù„Ù„ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚Ù.", a: true },
      ];

      const mcqQuestions = [
        {
          q: "Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ù…Ø¯ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù„Ù„Ø³ÙƒÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚Ù Ù‡Ùˆ:",
          options: ["Ø­Ø±ÙƒØ© ÙˆØ§Ø­Ø¯Ø©", "2 Ø£Ùˆ 4 Ø£Ùˆ 6 Ø­Ø±ÙƒØ§Øª", "5 Ø­Ø±ÙƒØ§Øª ÙˆØ¬ÙˆØ¨Ø§Ù‹"],
          a: 1,
        },
        {
          q: "Ø´Ø±Ø· Ø§Ù„ÙˆØ§Ùˆ ÙˆØ§Ù„ÙŠØ§Ø¡ ÙÙŠ Ù…Ø¯ Ø§Ù„Ù„ÙŠÙ† Ø£Ù† ØªÙƒÙˆÙ†Ø§:",
          options: ["Ù…ØªØ­Ø±ÙƒØªÙŠÙ†", "Ø³Ø§ÙƒÙ†ØªÙŠÙ† ÙˆÙ‚Ø¨Ù„Ù‡Ù…Ø§ ÙƒØ³Ø±", "Ø³Ø§ÙƒÙ†ØªÙŠÙ† ÙˆÙ‚Ø¨Ù„Ù‡Ù…Ø§ ÙØªØ­"],
          a: 2,
        },
        {
          q: "Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù…Ù…Ø§ ÙŠÙ„ÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¯ Ù„ÙŠÙ†ØŸ",
          options: ["Ø§Ù„Ù’Ø¨ÙÙŠÙ’ØªÙ", "Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù", "Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§Ø¡Ù"],
          a: 0,
        },
        {
          q: "ÙŠÙ†Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ Ø§Ù„Ù„Ø§Ø²Ù… Ø§Ù„ÙƒÙ„Ù…ÙŠ Ø¥Ù„Ù‰:",
          options: ["Ù…Ø«Ù‚Ù„ ÙˆÙ…Ø®ÙÙ", "Ø¹Ø§Ø±Ø¶ ÙˆÙ„ÙŠÙ†", "Ù…ØªØµÙ„ ÙˆÙ…Ù†ÙØµÙ„"],
          a: 0,
        },
        {
          q: "Ø£ÙŠ Ù…Ø¯ ÙŠÙ†Ø¯Ø±Ø¬ ØªØ­Øª Ø§Ù„Ù…Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø³ÙƒÙˆÙ†ØŸ",
          options: ["Ø§Ù„Ù…Ø¯ Ø§Ù„Ù…ØªØµÙ„", "Ø§Ù„Ù…Ø¯ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù„Ù„Ø³ÙƒÙˆÙ†", "Ù…Ø¯ Ø§Ù„Ø¨Ø¯Ù„"],
          a: 1,
        },
      ];

      // --- State ---
      let score = 0;
      let currentQIndex = 0;
      let isPhase2 = false;
      let currentLevel = "Ù…Ø¨ØªØ¯Ø¦";

      // --- Logic ---

      function showSection(id) {
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");
        window.scrollTo(0, 0);
      }

      function scrollToId(id) {
        document.getElementById(id).scrollIntoView({ behavior: "smooth" });
      }

      function updateStats() {
        document.getElementById("score").innerText = score;
        if (score >= 50) currentLevel = "Ù…ØªÙˆØ³Ø·";
        if (score >= 80) currentLevel = "Ø£Ø³ØªØ§Ø° Ø§Ù„ØªØ¬ÙˆÙŠØ¯";
        document.getElementById("level").innerText = currentLevel;
      }

      function startQuiz() {
        score = 0;
        currentQIndex = 0;
        isPhase2 = false;
        updateStats();
        showSection("game");
        loadQuestion();
        SoundManager.init(); // Ensure audio context starts
      }

      function loadQuestion() {
        document.getElementById("feedback-modal").style.display = "none";

        // Check phases
        if (!isPhase2 && currentQIndex >= tfQuestions.length) {
          isPhase2 = true;
          currentQIndex = 0;
          // Intro to Phase 2 alert or animation could go here
        }

        if (isPhase2 && currentQIndex >= mcqQuestions.length) {
          finishGame();
          return;
        }

        // Update UI Text
        document.getElementById("q-num").innerText =
          (isPhase2 ? 5 : 0) + currentQIndex + 1;
        document.getElementById("phase-title").innerText = isPhase2
          ? "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©"
          : "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØµØ­ Ø£Ù… Ø®Ø·Ø£";

        const qBox = document.getElementById("question-text");
        const tfBtns = document.getElementById("tf-buttons");
        const mcqBtns = document.getElementById("mcq-buttons");

        if (!isPhase2) {
          // TF Mode
          qBox.innerText = tfQuestions[currentQIndex].q;
          tfBtns.classList.remove("hidden");
          mcqBtns.classList.add("hidden");
        } else {
          // MCQ Mode
          const qData = mcqQuestions[currentQIndex];
          qBox.innerText = qData.q;
          tfBtns.classList.add("hidden");
          mcqBtns.classList.remove("hidden");

          mcqBtns.innerHTML = "";
          qData.options.forEach((opt, index) => {
            const btn = document.createElement("button");
            btn.className = "ans-btn";
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index);
            mcqBtns.appendChild(btn);
          });
        }
      }

      function checkAnswer(userAns) {
        let isCorrect = false;
        let correctAnsText = "";

        if (!isPhase2) {
          isCorrect = userAns === tfQuestions[currentQIndex].a;
        } else {
          isCorrect = userAns === mcqQuestions[currentQIndex].a;
        }

        if (isCorrect) {
          score += 10;
          showFeedback(true);
          SoundManager.play("success");
        } else {
          showFeedback(false);
          SoundManager.play("error");
        }
        updateStats();
      }

      function showFeedback(isCorrect) {
        const modal = document.getElementById("feedback-modal");
        const icon = document.getElementById("feedback-icon");
        const title = document.getElementById("feedback-title");
        const msg = document.getElementById("feedback-msg");

        modal.style.display = "flex";

        if (isCorrect) {
          icon.innerText = "ğŸŒŸ";
          title.innerText = "Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø©!";
          title.style.color = "var(--success)";
          msg.innerText = "Ø£Ø­Ø³Ù†ØªØŒ Ø§Ø³ØªÙ…Ø± ÙŠØ§ Ø¨Ø·Ù„!";
        } else {
          icon.innerText = "ğŸ¤”";
          title.innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
          title.style.color = "var(--error)";
          msg.innerText = "Ù„Ø§ Ø¨Ø£Ø³ØŒ ØªØ¹Ù„Ù… Ù…Ù† Ø®Ø·Ø¦Ùƒ ÙˆØªØ§Ø¨Ø¹.";
        }
      }

      function nextQuestion() {
        currentQIndex++;
        loadQuestion();
      }

      function finishGame() {
        const modal = document.getElementById("feedback-modal");
        modal.style.display = "flex";
        document.getElementById("feedback-icon").innerText = "ğŸ†";
        document.getElementById("feedback-title").innerText = "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!";
        SoundManager.play("win");
        document.getElementById(
          "feedback-msg"
        ).innerHTML = `Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${score} Ù…Ù† 100<br>Ù…Ø³ØªÙˆØ§Ùƒ: ${currentLevel}`;

        // Change button to go home
        const btn = modal.querySelector("button");
        btn.innerText = "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©";
        btn.onclick = () => {
          modal.style.display = "none";
          showSection("home");
          // Reset button behavior for next game
          btn.innerText = "Ø§Ù„ØªØ§Ù„ÙŠ â¡";
          btn.onclick = nextQuestion;
        };
      }

      // --- Sound System ---
      // --- Sound System (Web Audio API) ---
      const SoundManager = {
        ctx: null,
        isMuted: false,

        init: function () {
          if (!this.ctx) {
            const AudioContext =
              window.AudioContext || window.webkitAudioContext;
            this.ctx = new AudioContext();
          }
          if (this.ctx.state === "suspended") {
            this.ctx.resume();
          }
        },

        play: function (type) {
          if (this.isMuted) return;
          this.init(); // Ensure context is ready

          const t = this.ctx.currentTime;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();

          osc.connect(gain);
          gain.connect(this.ctx.destination);

          switch (type) {
            case "click":
              // Short high-pitch "pop"
              osc.type = "sine";
              osc.frequency.setValueAtTime(800, t);
              osc.frequency.exponentialRampToValueAtTime(300, t + 0.1);
              gain.gain.setValueAtTime(0.1, t);
              gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
              osc.start(t);
              osc.stop(t + 0.1);
              break;

            case "success":
              // "Ding" - Major chime
              this.playTone(600, "sine", 0.1, 0, 0.1); // C
              this.playTone(800, "sine", 0.1, 0.1, 0.1); // E
              setTimeout(() => this.playTone(1200, "sine", 0.3, 0, 0.4), 200); // High G
              break;

            case "error":
              // "Buzz" - Sawtooth descending
              osc.type = "sawtooth";
              osc.frequency.setValueAtTime(150, t);
              osc.frequency.linearRampToValueAtTime(50, t + 0.3);
              gain.gain.setValueAtTime(0.1, t);
              gain.gain.linearRampToValueAtTime(0.01, t + 0.3);
              osc.start(t);
              osc.stop(t + 0.3);
              break;

            case "win":
              // Fanfare sequence
              const notes = [523.25, 659.25, 783.99, 1046.5]; // C E G C
              notes.forEach((freq, i) => {
                this.playTone(freq, "square", 0.1, i * 0.1, 0.1, 0.05);
              });
              this.playTone(1046.5, "square", 0.4, 0.4, 0.1); // Hold last note
              break;
          }
        },

        playTone: function (freq, type, duration, delay = 0, vol = 0.1) {
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          const t = this.ctx.currentTime + delay;

          osc.connect(gain);
          gain.connect(this.ctx.destination);

          osc.type = type;
          osc.frequency.value = freq;

          gain.gain.setValueAtTime(vol, t);
          gain.gain.exponentialRampToValueAtTime(0.01, t + duration);

          osc.start(t);
          osc.stop(t + duration);
        },

        toggleMute: function () {
          this.isMuted = !this.isMuted;
          const btn = document.getElementById("mute-btn");
          btn.innerText = this.isMuted ? "ğŸ”‡" : "ğŸ”Š";
        },
      };

      // Add Global Click Sound for Buttons
      document.addEventListener("click", (e) => {
        if (e.target.tagName === "BUTTON" || e.target.closest("button")) {
          // Avoid playing click sound twice if the button has its own handler that plays a specific sound (like answer buttons playing success/fail instantly?
          // Actually, answer buttons play sound inside checkAnswer logic.
          // Let's play 'click' for nav buttons mainly.
          if (!e.target.classList.contains("ans-btn")) {
            // Don't play generic click for game answers to avoid overlap with success/fail
            SoundManager.play("click");
          }
        }
      });
    </script>
  </body>
</html>
